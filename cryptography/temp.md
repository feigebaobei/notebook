
## 椭圆曲线算法的基本原理及实现

### 1、基本概念

椭圆曲线方程的一般形式：`y^2 = x^3 + a*x + b`，其中要求满足不等式 `4*a^3 + 27*b^2 ≠ 0`
例如：y^2 = x^3 + x + 1 mod 23

### 椭圆

平面内与2定点的距离之和等于常数的点的轨迹叫做椭圆。
2个定点：椭圆的焦点。     2a
焦点的距离：椭圆的焦距。   2c
若2a > 2c (c != 0) 则为椭圆
  2a = 2c             直线
  2a < 2c             无轨迹
椭圆的标准方程 `x^2 / a^2 + y^2 / b^2 = 1 (a>b>0)`



## 国密

||||
|-|-|-|
|sm2|非对称算法||
|sm3|摘要算法||
|sm4|对称加密算法||

```
      server              client
            send publicKey
                      使用公钥加密
            把加密数据发给后端
      <-----------------------
      使用相应私钥解密
```

### sm2

|contain||||
|-|-|-|-|
|C1|生成随机数的计算出的椭圆曲线点|||
|C2|密文数据|||
|C3|sm3的摘要值|||

原来使用C1C2C3顺序存放，现在使用C1C3C2顺序存放。

### sm3
### sm4






数学运算符号 mod 求余 如:7mod3=1
Fp 素域 p个素数组成的集合。

### 3 术语和定义
下列术语和定义适用于本部分。
3.1
数字签名 digital signature
附加在数据单元上的一些数据，或是对数据单元所作密码变换的结果，当正常应用时提供如下服
务：
a) 数据来源的确认；
b) 数据完整性的验证；
c) 签名者不可抵赖的保证。
[ANSI X9.63-2001]
3.2
消息　message
任意有限长度的比特串。
[ISO/IEC 15946-4 3.7]
3.3
签名消息　signed message
由消息以及该消息的签名部分所组成的一组数据项。
[ISO/IEC 15946-4 3.14]
3.4
密钥　key
确定密码函数运算的一个参数，它用于：
a) 加密或解密变换；
b) 同步产生共享秘密；
c) 数字签名的生成或验证。
[ANSI X9.63-2001]
3.5
私钥　private key
在非对称密码体制中，实体自己保持的、只有实体自身知道的一种密钥。
[ISO/IEC 15946-3 3.24]
3.6
公钥　public key
在非对称密码体制中，实体的一种可以公开的密钥。
[ISO/IEC 15946-3 3.25]
3.7
签名密钥 signature key
在数字签名生成过程中由签名者专用的秘密数据项，即签名者的私钥。
[ISO/IEC 15946-2 3.1.7]
3.8
随机数序列　random number sequence
数列中的每一项在已知其它项的情况下都无法被推断的一种数列。
[ΓOCT P 34.10-2001 3.1.7]
3.9
杂凑函数　hash function
将一个比特串映射为一个固定长度比特串的函数。该函数满足如下性质：
a) 对于任意给定的输出，要找到其对应的输入，在计算上是不可行的；
b) 对于任意给定的输入，要找到输出相同的另一个输入，在计算上是不可行的。
注：计算可行性依赖于具体的安全需求和环境。
[ISO/IEC 15946-2 3.1.3]
3.10
杂凑值　hash value
杂凑函数作用于一条消息时输出的比特串。
[ISO/IEC 15946-2 3.1.2]
3.11
签名生成过程　signature process
输入消息、签名密钥和椭圆曲线系统参数，并输出数字签名的过程。
[ISO/IEC 15946-2 3.1.8]
3.12
不可抵赖　non-repudiation
证明某一动作或事件已经发生的能力，以使事后不能否认这一动作或事件。
[ISO/IEC 13888-1]
3.13
可辨别标识　distinguishing identifier
可以无歧义辨别某一实体身份的信息。
[ISO/IEC 15946-3 3.9]
4 符号
下列符号适用于本部分。
A,B：使用公钥密码系统的两个用户。
a,b：Fq中的元素，它们定义Fq上的一条椭圆曲线E。











SM2 算法的椭圆曲线是ECC曲线的其中一种。






sublime sublimerge 比较2个文件的不同






// 使用github上的sm2输出的私钥
the privateKey = & {
  PublicKey: {
    Curve: {
      RInverse: +57896044551258231062740198220913455226441901632205615997740090104278065086466
      CurveParams: 0xc0000c6000
      a: [536870905 268435455 895 268428288 536870911 268435455 536870911 150994943 268435455]
      b: [394377860 220399154 355969936 163370829 236861671 88177300 303341152 24396229 75627569]
      gx: [137364797 52992271 113266657 202339045 31563580 107393171 24488059 247693942 35835723]
      gy: [408558522 55895443 311818945 254526569 75260154 203012265 258167614 151236203 209300666]
    }
    X: +34224655832475983555843728280051850325880358563726997903574411547310022221696
    Y: +65906813122046500349833570446030028673443276139006280228984505670300372656366
  }
  D: +39930750887148081541035146252377212826285048033395152673893704813613712531027
}
the encrypt msg = 0402 af600e5b3a925d4efd73fa0c270cd5c087fad2687657ac4cbe764a8a9c3417e801ee3f9377a18ab7b96b577716edfba0f10fa0cd787df94905970e4a449feeaf37b0950d62bbf3c3b0ef401afd5a08367dc86b9de91e1a8efe28a7be7b1200ee4f581d0795d0caf0811480570312a25e68d70221c02747163073cc9bbdf045472675770395
the msg = i am wek && i am The_Reader too。

{
    PublicKey:
    {
        Curve:
        {
            RInverse: +57896044551258231062740198220913455226441901632205615997740090104278065086466
            CurveParams: 0xc000090040
            a: [536870905 268435455 895 268428288 536870911 268435455 536870911 150994943 268435455]
            b: [394377860 220399154 355969936 163370829 236861671 88177300 303341152 24396229 75627569]
            gx: [137364797 52992271 113266657 202339045 31563580 107393171 24488059 247693942 35835723]
            gy: [408558522 55895443 311818945 254526569 75260154 203012265 258167614 151236203 209300666]
        }
        X: +84672594994883691749812147323915243397149424295750863161738437035735611188067
        Y: +80199447914287822457079413648612653186801572090004339655568380287586400127871
    }
    D: +50659251304539073762256307438869004195974652100915089473428870745521197467960
}





【1】
课程：Online Cryptography Course
单位：斯坦福大学
主讲人：Dan Boneh等
https://www.bilibili.com/video/av59014949

【2】
课程：Cryptography & Cryptanalysis
单位：麻省理工学院
主讲人：Shafi Goldwasser等
https://www.bilibili.com/video/av58961353

【3】
课程：Journey into Cryptography
单位：可汗学院
主讲人：不详
https://www.bilibili.com/video/av5003323

【4】
课程：Basics of Cryptography
单位：STMicroelectronics
主讲人：不详
https://www.bilibili.com/video/av69773353

【5】
课程：Mathematics in Cryptography
单位：Institute for Advanced Study
主讲人：Toni Bluher
https://www.bilibili.com/video/av24305997

【6】
课程：密码学
单位：解放军信息工程大学
主讲人：金晨辉等
https://www.bilibili.com/video/av20135839/

【7】
课程：密码学
单位：武汉大学
主讲人：张焕国等
https://www.bilibili.com/video/av41333023/

【8】
课程：密码学基础
单位：北京航空航天大学
主讲人：郭华等
https://www.bilibili.com/video/av21472093

【9】
课程：密码学原理
单位：华中科技大学
主讲人：汤学明等
https://www.bilibili.com/video/av48940190

【10】
课程：信息系统安全与对抗实践
单位：北京理工大学
主讲人：罗森林等
https://www.bilibili.com/video/av76832042

【11】
课程：现代密码学
单位：电子科技大学
主讲人：聂旭云等
https://www.bilibili.com/video/av58596164

【12】
课程：信息安全概论
单位：西安电子科技大学
主讲人：李晖等
https://www.bilibili.com/video/av85973277




# 密码学（斯坦福大学2015版）

## 课程内容

### 课程目标
- 学习如何加密原始的工作。
学习如何正确使用它们，并考虑安全性。

### 推荐
- 多做笔记
经常暂停思考原理
回答视频里的问题

### 用途

安全通信
- web traffic: https
wireless traffic: 802.11i WPA2, GSM, Bluetooth

加密硬盘： EFS, TrueCrypt
保护内容：CSS, AACS (两者都是加密方法。aacs > css)
用户验证
...

### secure sockets layer / tls

1. 握手协议：建立分享密钥，使用公钥加密。
2. record layer: 使用分享密钥传递数据。确保完整和保密。

### 在硬盘上保护文件

类型与安全通信：昨天的A给明天的A说……

### 构建块：sym.encryption

```
                 Alice                                          Bob
              |-----------|                                 |-----------|
        m     |           |    E(k,m)=c               m     |           |    D(k,m)=m
    --------->|     E     |----------------->发送站--------->|     D     |---------->
              |           |                                 |           |
              |-----------|                                 |-----------|
                    ^                                             ^
                    |                                             |
                    |                                             |
                    k                                             k

    m plaintext
    c ciphertext
    E, D cipher
    k secret key
```
加密算法是公开的，不要使用专用密码。

### use cases

使用一个密钥
使用多个密钥
- 使用多种方式加密。如加密文件。
比一个密钥有更多原理。

### 回顾

密码是一个极好的工具。
是很多安全机制的基础。
不能解决所有安全问题。
若使用合适，它是一个很好的方法。
有些东西需要你自己创造。

## 什么是密码

### 密码的核心

- 建立密钥
安全通信

密码可以做很多事
- 数字签名
匿名通信
匿名数字货币

### title

### title

### title

### title

### title

### title

### title

### title

### title

### title

### title

### title

### title

### title

### title

### title

### title

### title

### title

### title

### title










# SM2算法

## 概览
### 它是商用密码
### sm2百科
### 《sm2椭圆曲线公钥密码算法》的4个部分

- 总则
数字签名算法
秘钥交换协议
公钥加密算法

### 运行机制

同时实现了数据完整性、身份验证、数据加密。

#### 加密过程

```
    明文 m
        |
      使用对方的单向加密算法
        |
        V
    得到m的特征码 h                检测数据完整性
        |
      使用自己的私钥加密h
        |
        V
    得到特征码 s                        实现身份验证
        |
      把s放在m的后面 t
      再生成一个密码 D
      使用D加密t                      实现数据加密
        |
        V
    得到密文Q
        |
      使用对方公钥加密D并放在Q的后面
        |
        V
    得到结果result
```

#### 解密过程

```
    收到结果result
        |
      使用自己的私钥解密
        |
        V
    得到D
        |
      用D解密Q                                     解密数据
        |
        V
    得到s和m
        |
      使用对方的公钥解密s
        |
        V
    是否可以解密                                    验证身份
        |                   |
        Y                   N
        |                   |
        V                   V
    是对方发来的。         不是对方发来的。
        |
      使用单向加密算法计算该段
      得到结果与发来的特征码比较
        |
        V
    是否相同                                        验证完整性
        |                   |
        Y                   N
        |                   |
        V                   V
    未被修改。            已被修改。
```
## ECC算法

sm2是基于ecc(椭圆曲线算法的).
sm2/ecc都是公开密钥算法。
需要有数学功底。《近世代数基础》《初等数论》等

### 平行线

与其说数学锻炼人的抽象能力，还不如说是锻炼人的想象力。

### title
### title
### title
### title
### 密码学中的椭圆曲线

不是连续的。
有限域是一种只有由有限个元素组成的域
并不是所有的椭圆曲线都适合加密。

#### ≡

“≡”是数论中表示同余的符号（注意！！这个不是恒等号），
同余的定义是这样的:
给定一个正整数n，如果两个整数a和b满足a-b能被n整除，即(a-b)modn=0，
那么就称整数a与b对模n同余，记作a≡b(modn)，同时可成立amodn=b。
也就是相当于a被n整除余数等于b的意思。

### 椭圆曲线上简单的加密/解密

K=kG  [其中 K,G为Ep(a,b)上的点，k为小于n（n是点G的阶）的整数]
不难发现，给定k和G，根据加法法则，计算K很容易；但给定K和G，求k就相对困难了。
这就是椭圆曲线加密算法采用的难题。我们把点G称为基点（base point），k`（k<n，n为基点G的阶）`称为私有密钥（privte key），K称为公开密钥（public key)。

1、用户A选定一条椭圆曲线Ep(a,b)，并取椭圆曲线上一点，作为基点G。
2、用户A选择一个私有密钥k，并生成公开密钥K=kG。
3、用户A将Ep(a,b)和点K，G传给用户B。
4、用户B接到信息后 ，将待传输的明文编码到Ep(a,b)上一点M（编码方法很多，这里不作讨论），并产生一个随机整数`r（r<n）`。
5、用户B计算点C1=M+rK；C2=rG。
6、用户B将C1、C2传给用户A。
7、用户A接到信息后，计算C1-kC2，结果就是点M。因为
C1-kC2=M+rK-k(rG)=M+rK-r(kG)=M
再对点M进行解码就可以得到明文。

密码学中，描述一条Fp上的椭圆曲线，常用到六个参量：
T=(p,a,b,G,n,h)。
（p 、a 、b 用来确定一条椭圆曲线，
G为基点，
n为点G的阶，
h 是椭圆曲线上所有点的个数m与n相除的整数部分）

1、p 当然越大越安全，但越大，计算速度会变慢，200位左右可以满足一般安全要求；
2、p≠n×h；
3、pt≠1 (mod n)，1≤t<20；
4、4a3+27b2≠0 (mod p)；
5、n 为素数；
6、h≤4。

## “七问”SM2椭圆曲线公钥密码算法

### sm2 > rsa

### SM2和椭圆曲线算法是什么关系?

SM2算法采用的椭圆曲线方程为：y2 = x3 + ax + b
通过确定a，b就能确定一条椭圆曲线。

### 椭圆曲线算法是什么原理?

在椭圆曲线算法中，将倍数d做为私钥，将Q做为公钥。当然，椭圆曲线算法还有更严格的计算过程，相对图示要复杂的多。

### SM2算法可以进行哪些密码应用?

1、签名、验签计算过程;
2、加密、解密计算过程;
3、密钥协商计算过程。

### SM2相关算法有哪些?

SM2，为国家密码管理局公布的公钥算法，其加密强度为256位。其它几个重要的商用密码算法包括：
SM1，对称加密算法，加密强度为128位，采用硬件实现;
SM3，密码杂凑算法，杂凑值长度为32字节，和SM2算法同期公布，参见《国家密码管理局公告(第 22 号)》;
SMS4，对称加密算法，随WAPI标准一起公布，可使用软件实现，加密强度为128位。

## 实现SM2秘钥交换协议的算法流程

## 12.数字证书原理

### 数字证书内容

- 证书的发布机构
证书的有效期
公钥
证书所有者（subject）
签名所使用的算法
指纹以及指纹算法





### title
### title
### title
### title






new 的作用是初始化一个指向类型的指针(`*T`)，make 的作用是为 slice，map 或 chan 初始化并返回引用(T)。








什么是hmac-drbg，Deterministic random bit generator (hmac) 确定性随机位发生器
NumberObject.toString(radix)
NumberObject 会被转换为radix进制值表示的字符串。
HMAC是密钥相关的哈希运算消息认证码（Hash-based Message Authentication Code）







SM2加密算法
输入：长度为klen的比特串M, 公钥PB
输出：SM2结构密文比特串C
算法：
1) 产生随机数k, k的值从1到n-1；
2) 计算椭圆曲线点C1=[k]G=(x1,y1), 将C1转换成比特串；
3) 验证公钥PB, 计算S=[h] PB，如果S是无穷远点，出错退出；
4) 计算(x2,y2)=[k] PB
5) 计算t=KDF(x2||y2, klen), KDF是密钥派生函数，如果t是全0比特串，返回第1）步。
6) 计算C2=M⊕t
7) 计算C3=Hash(x2||M||y2)
8) 输出密文C=C1||C3||C2,  C1和C3的长度是固定的，C1是64字节，C3是32字节，很方便C从中提取C1，C3和C2。
注：通过密钥派生函数计算，才能进行第6)步的按位异或计算。

M⊕R=S // 用R异或M得到S

SM2解密算法
输入：SM2结构密文比特串C, 私钥dB
输出：明文M’
算法：
1) 从密文比特串C=C1||C3||C2中取出C1， 将C1转换成椭圆曲线上的点；
2) 验证C1, 计算S=[h] C1，如果S是无穷远点，出错退出；
4) 计算(x2,y2)=[dB] C1
5) 计算t=KDF(x2||y2, klen), KDF是密钥派生函数，如果t是全0比特串，出错退出。
6) 从C=C1||C3||C2中取出C2，计算M’= C2⊕t。
7) 计算u=Hash(x2||M’||y2)，比较u是否与C3相等，不相等则退出。
8) 输出明文M’。





sm.js
drbg deterministic random bit generator 伪随机数发生器 确定性随机数产生器。
hmac hash-based message authentication code 哈希消息运算认证码




小程序使用npm包开发。
detail -> use npm modules
tools -> build npm